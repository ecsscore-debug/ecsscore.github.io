<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ECS Dashboard | Verified Workforce Score</title>

<style>
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: #0A0F1F;
  color: #E4E9F7;
}

header {
  background: #11192C;
  padding: 18px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

header h1 { margin: 0; font-size: 20px; font-weight: 600; }
header button {
  background: #007AFF;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
}

.container { max-width: 900px; margin: 30px auto; padding: 0 20px; }

.card {
  background: #10182F;
  padding: 22px;
  border-radius: 14px;
  margin-bottom: 22px;
  border: 1px solid rgba(0, 122, 255, 0.2);
  box-shadow: 0 0 18px rgba(0,0,0,0.5);
}

.verified-badge {
  background: #00D26A;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 13px;
  margin-left: 8px;
}

button.btn {
  background: linear-gradient(90deg, #0066FF, #00D4FF);
  padding: 10px 18px;
  border-radius: 8px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  margin-top: 12px;
  color: #fff;
  width: 100%;
}

.score-circle {
  width: 130px; height: 130px;
  border-radius: 50%;
  margin: 25px auto;
  background: conic-gradient(#00D4FF 0deg, #1B253A 0deg);
  display: flex; justify-content: center; align-items: center;
  font-size: 32px; font-weight: 800;
  color: #00D4FF;
}

.hidden { display: none; }
p { color: #bfc6da; }
</style>
</head>

<body>

<header>
  <h1>ECS Verified Dashboard</h1>
  <button onclick="logout()">Logout</button>
</header>

<div class="container">

<!-- USER INFO CARD -->
<div class="card">
  <h2>Welcome, <span id="dName">User</span>
    <span class="verified-badge">Verified</span>
  </h2>
  <p id="dEmail">your@email.com</p>
</div>

<!-- PROFILE COMPLETION CARD -->
<div class="card">
  <h3>Complete Your Verified Profile</h3>
  <p>Your employment authenticity will shape your ECS score.</p>
  <button class="btn" onclick="openForm()">Complete Profile</button>
</div>

<!-- SCORE CARD -->
<div class="card">
  <h3>Your ECS Score</h3>
  <div class="score-circle" id="score">...</div>
  <p style="text-align:center;">Auto-updated after verification.</p>
</div>

</div>

<script>
function openForm() {
  window.open(
    "https://docs.google.com/forms/d/e/1FAIpQLScCic3H4IhyCzbobJBnMUC5ipVTYjDM_rJ815CDQk1jgxbHjg/viewform?usp=header",
    "_blank"
  );
}

// Store login user (temporary)
document.getElementById("dName").innerText = localStorage.getItem("ecs_name") || "Candidate";
document.getElementById("dEmail").innerText = localStorage.getItem("ecs_email") || "Not Provided";

// ✅ Fetch data from Google Sheet via Apps Script Web App
async function loadProfile() {
  const email = localStorage.getItem("ecs_email");
  if (!email) {
    document.getElementById("score").innerText = "Login Needed";
    return;
  }

  const api = "https://script.google.com/macros/s/AKfycbzQXhZgi0Mg-rvxsAPS8DmWNA5KJPch9_pLfs7fU2eX4eY891IRV7kYNQRf7mbvXLM/exec"; // <<< replace this only once
  try {
    const res = await fetch(api + "?email=" + email);
    const data = await res.json();

    if(data.error){
      document.getElementById("score").innerText = "Awaiting Data";
      return;
    }

    // Show name & email from sheet
    document.getElementById("dName").innerText = data["Full Name"];
    document.getElementById("dEmail").innerText = data["Email Address"];

    // Simple demo scoring logic
    let score = Math.min(95, 60 + Math.floor(Math.random()*40));
    animateScore(score);

  } catch(e){
    document.getElementById("score").innerText = "Error";
  }
}

// ✅ Score animation
function animateScore(finalScore){
  let v = 0;
  let circle = document.getElementById("score");
  let x = setInterval(()=>{
    if(v >= finalScore) clearInterval(x);
    circle.innerText = v;
    circle.style.background = `conic-gradient(#00D4FF ${(v/100)*360}deg,#1B253A 0deg)`;
    v++;
  },15);
}

function logout(){
  localStorage.clear();
  location.href = "/";
}

// Call fetch function
loadProfile();
</script>

</body>
</html>
