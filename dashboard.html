<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ECS Dashboard — Candidate</title>
<style>
:root{--bg:#05060b;--card:#0b1220;--accent:#00D4FF;--muted:#9aa4b2;--white:#E6EEF8}
body{margin:0;background:linear-gradient(180deg,#041027,#071825);color:var(--white);font-family:Inter, Poppins, system-ui;padding:18px}
.container{max-width:980px;margin:16px auto}
header{display:flex;justify-content:space-between;align-items:center}
.btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
.btn-primary{background:linear-gradient(90deg,#0066FF,#00D4FF);color:#031024}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:14px;border-radius:10px;margin-top:12px;border:1px solid rgba(255,255,255,0.02)}
.row{display:flex;gap:12px;align-items:center}
.col{flex:1}
.score{width:140px;height:140px;border-radius:50%;display:grid;place-items:center;font-size:36px;font-weight:900;background:conic-gradient(#00D4FF 0deg,#0f1724 0deg);margin:8px auto}
.small{color:var(--muted)}
input,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--white);margin-top:8px}
label{font-weight:700;margin-top:8px;display:block}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
.admin-note{font-size:13px;color:var(--muted);margin-top:6px}
small.badge{background:rgba(0,212,255,0.06);color:var(--accent);padding:6px 8px;border-radius:8px;font-weight:800}
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <div style="font-weight:900">ECS Dashboard</div>
      <div class="small">Your verified profile center</div>
    </div>
    <div>
      <button class="btn btn-primary" onclick="openForm()">Complete Profile</button>
      <button class="btn" onclick="logout()" style="margin-left:8px">Logout</button>
    </div>
  </header>

  <!-- Profile card -->
  <div class="card" id="profileCard">
    <div class="row">
      <div class="col">
        <div style="font-weight:900;font-size:20px" id="dName">Candidate</div>
        <div class="small" id="dEmail">you@domain.com</div>
        <div class="small" id="dAbout" style="margin-top:8px">Profile summary will appear here.</div>
      </div>
      <div style="width:220px;text-align:center">
        <div class="score" id="scoreDisplay">--</div>
        <div class="small">ECS Score</div>
      </div>
    </div>
    <div class="admin-note">Note: This dashboard is a demo. Real verification updates come from backend & manual verification flows.</div>
  </div>

  <!-- Employment history -->
  <div class="card">
    <div style="font-weight:900">Employment History (last 3)</div>
    <table id="empTable"><tr><th>Company</th><th>Role</th><th>Duration</th><th>Peer contact</th></tr></table>
  </div>

  <!-- Resume -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:900">Resume</div>
      <div class="small">Uploaded file: <span id="resumeName">—</span></div>
    </div>
    <div style="margin-top:8px">
      <a id="resumeLink" href="#" target="_blank" class="small">Open resume (demo)</a>
    </div>
  </div>

  <!-- Admin style manual update to simulate backend -->
  <div class="card">
    <div style="font-weight:900">Admin / Mock Backend Panel</div>
    <div class="small" style="margin-top:6px">Use this to simulate backend updates that would normally push scores and verified flags to the user's profile.</div>

    <label>Update Score (0-100)</label>
    <input id="adminScore" type="number" min="0" max="100" placeholder="e.g. 92" />
    <label>Mark Verified?</label>
    <select id="adminVerified"><option value="true">Yes (Verified)</option><option value="false">No</option></select>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn btn-primary" onclick="applyAdmin()">Apply update</button>
      <button class="btn" onclick="resetDemo()">Reset demo</button>
    </div>
    <div id="adminMsg" class="small" style="margin-top:8px"></div>
  </div>

  <div style="height:40px"></div>
</div>

<script>
/* FORM URL (same as index) */
const FORM_URL = "https://tally.so/r/rjyj2p";

/* open form in new tab */
function openForm(){ window.open(FORM_URL,"_blank"); alert("Form opened in new tab. Fill it and we'll contact you."); }

/* Demo persistence: localStorage under key ecs_profile_demo */
function saveLocal(profile){
  localStorage.setItem("ecs_profile_demo", JSON.stringify(profile));
}
function loadLocal(){
  return JSON.parse(localStorage.getItem("ecs_profile_demo") || "{}");
}

/* Render dashboard from localStorage (fall back to sample) */
function render(){
  const p = loadLocal();
  const name = p.name || "Professional Candidate";
  document.getElementById("dName").innerText = name;
  document.getElementById("dEmail").innerText = p.email || "Not provided";
  document.getElementById("dAbout").innerText = p.about || "Complete your profile to start verification.";
  document.getElementById("resumeName").innerText = p.resumeName || "No resume";
  if(p.resumeUrl) { document.getElementById("resumeLink").href = p.resumeUrl; document.getElementById("resumeLink").innerText = "Open resume"; }
  else { document.getElementById("resumeLink").href="#"; document.getElementById("resumeLink").innerText = "No resume uploaded"; }

  // employment table
  const table = document.getElementById("empTable");
  table.innerHTML = "<tr><th>Company</th><th>Role</th><th>Duration</th><th>Peer contact</th></tr>";
  (p.orgs || []).forEach(o=>{
    if(o && o.name) table.innerHTML += `<tr><td>${escapeHtml(o.name)}</td><td>${escapeHtml(o.role)}</td><td>${escapeHtml(o.duration)}</td><td>${escapeHtml(o.peer)}</td></tr>`;
  });

  // score
  const score = p.score ?? "--";
  document.getElementById("scoreDisplay").innerText = score;
  const deg = (Number(score) || 0) / 100 * 360;
  document.getElementById("scoreDisplay").style.background = `conic-gradient(var(--accent) ${deg}deg, rgba(255,255,255,0.02) 0deg)`;
}

function escapeHtml(s){ if(!s) return ""; return s.replaceAll("<","&lt;").replaceAll(">","&gt;"); }

/* Admin apply update (simulate backend) */
function applyAdmin(){
  const s = Number(document.getElementById("adminScore").value);
  const verified = document.getElementById("adminVerified").value === "true";
  if(isNaN(s) || s<0 || s>100){ alert("Enter 0-100"); return; }
  const p = loadLocal();
  p.score = s;
  p.verified = verified;
  saveLocal(p);
  document.getElementById("adminMsg").innerText = "Applied — profile updated locally (simulates backend push).";
  render();
}

/* Reset demo data */
function resetDemo(){
  localStorage.removeItem("ecs_profile_demo");
  document.getElementById("adminMsg").innerText = "Demo reset.";
  render();
}

/* Quick sample seed for first-time dev/testers */
(function seedIfEmpty(){
  if(!localStorage.getItem("ecs_profile_demo")){
    const sample = {
      name: "Priya Sharma",
      email: "priya.sharma@example.com",
      about: "Product Ops · 6 yrs · hiring & onboarding",
      resumeName: "Priya_Sharma_Resume.pdf",
      resumeUrl: "#",
      orgs:[
        {name:"Findoc Group", role:"Executive Assistant", duration:"2023 - Present", peer:"hr@findoc.com"},
        {name:"Religare Broking", role:"Ops Analyst", duration:"2021 - 2023", peer:"manager@religare.com"},
        {name:"CYL", role:"Coordinator", duration:"2019 - 2021", peer:"lead@cyl.org"}
      ],
      score: 82,
      verified: true
    };
    saveLocal(sample);
  }
  render();
})();

/* Logout */
function logout(){ localStorage.removeItem("ecs_profile_demo"); location.href = "/"; }

/* Placeholder: where you'd call backend to fetch profile by email
   Example:
   async function loadProfileFromApi(email){
     const res = await fetch("YOUR_WEB_APP_URL?email=" + encodeURIComponent(email));
     return res.json();
   }
   Then save the returned object to localStorage format above.
*/
</script>
</body>
</html>
